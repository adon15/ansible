 - name: "Deployin Java app on tomcat server"
   hosts: all
   become: true
   tasks:
    - name: Clone a github repository
      git:
        repo: https://github.com/upshiftnow/addressbook 
        dest: /home/ubuntu/finalproject
        clone: yes
        update: yes
       
    - name: "Install Maven using Ansible"
      apt:
          name: "maven"
          state: present
          update_cache: yes

    - name: Deploy Apache Tomcat on Ubuntu for your java web applications
      gather_facts: yes
      become: true
      tasks:
        - name: Installing OpenJDK 8 to the host(s)
          apt:
            name: openjdk-8-jdk
            update_cache: yes
            state: present
        - name: Deleting content & directory
          file:
            state: absent
            path: /opt/tomcat
            - name: Creating /opt/tomcat directory
          file:
            path: /opt/tomcat
            state: directory
            mode: 0755
        - name: Downloading & unarchiving
          unarchive:
            src: "{{ tomcat_archive_url }}"
            dest: /opt/tomcat
            remote_src: yes
            extra_opts: [--strip-components=1]- name: Adding tomcat group
          group:
            name: tomcat- name: Adding tomcat user
          user:
            name: tomcat
            group: tomcat
            home: /user/share/tomcat
            createhome: no
        - name: Changing ownership
          file:
            path: /opt/tomcat
            owner: tomcat
            group: tomcat
            mode: "u+rwx,g+rx,o=rx"
            recurse: yes
            state: directory
        - name: Copying Tomcat service file from local to remote
          copy:
             src: files/tomcat.service
             dest: /etc/systemd/system/
             mode: 0755- name: Starting and enabling Tomcat service
          systemd:
            name: tomcat
            state: restarted
            enabled: true
            daemon_reload: true
          
          

